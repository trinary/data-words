<script>
  var scale = function(domain, range) {
    return function(v) { 
      var s = ((range[1] - range[0]) / (domain[1] - domain[0]))
      return (v * s) + (range[0] - (s * domain[0]));
    }
  }

  var pathString = function(values, width, height) {
    var space = width / values.length,
        y = scale([Math.min.apply({},values), Math.max.apply({},values)], [height,0]);
    return "M0," + height + " "  + values.map(function(d,i) { return 'L' + (space*i) + ',' + y(d)}).join(' ');
  }
  var sparkProto = Object.create(HTMLElement.prototype, {
    createdCallback: {
      value: function() {
        var t = document.createElement('svg'),
          path = "",
          root = this.createShadowRoot(),
          w = this.getAttribute("width") || 80,
          h = this.getAttribute("height") || 20,
          data = this.getAttribute("data").split(/\s+/).map(function(d) { return parseFloat(d)});
        
        t.setAttribute("width", w);
        t.setAttribute("height", h);
        this.setAttribute("style","display: inline;");
        path = pathString(data, w, h);
        t.innerHTML = '<path fill="none" stroke="#333" d="' + path + '"/>';
        root.innerHTML = t.outerHTML;
      }
    }
  });

  Object.defineProperty(sparkProto, "width", {value: 80});
  Object.defineProperty(sparkProto, "height", {value: 20});
  Object.defineProperty(sparkProto, "data", {value : "",
                                              writable : true,
                                              enumerable : true,
                                              configurable : true});

  var Spark = document.register('dw-sparkline',{
    prototype: sparkProto
  });
</script>
